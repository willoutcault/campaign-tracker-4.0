{% extends "base.html" %}
{% block content %}
<h3>{{ 'Edit' if tl else 'New' }} Target List</h3>
<form method="post" enctype="multipart/form-data">  <!-- IMPORTANT -->
  <div class="row g-3">
    <div class="col-md-4">
      <label class="form-label">Label</label>
      <input class="form-control" type="text" name="label" value="{{ tl.label if tl else '' }}" required>
    </div>

    <!-- Upload a file -->
    <div class="col-md-4">
      <label class="form-label">Upload File</label>
      <input class="form-control" type="file" name="file" accept=".csv,.xlsx,.xls,.zip,.txt">
      <div class="form-text">Upload here to store in S3.</div>
    </div>

    <!-- OR paste an S3 key -->
    <div class="col-md-4">
      <label class="form-label">OR Paste S3 Key</label>
      <input class="form-control" type="text" name="s3_key" value="{{ tl.s3_key if tl else '' }}" placeholder="target-lists/...">
      <div class="form-text">If provided, this is used instead of uploading.</div>
    </div>

    <div class="col-md-4">
      <label class="form-label">Original Filename (optional)</label>
      <input class="form-control" type="text" name="original_filename" value="{{ tl.original_filename if tl else '' }}">
    </div>
  </div>

  <div class="row g-3 mt-1">
    <div class="col-md-6">
      <label class="form-label">Pharmas</label>
      <select class="form-select" name="pharma_ids" multiple size="8">
        {% for p in pharmas %}
        <option value="{{ p.id }}" {% if selected_pharma_ids and p.id in selected_pharma_ids %}selected{% endif %}>{{ p.name }}</option>
        {% endfor %}
      </select>
      <div class="form-text">Hold Ctrl/âŒ˜ to select multiple.</div>
    </div>
    <div class="col-md-6">
      <label class="form-label">Brands</label>
      <select class="form-select" name="brand_ids" multiple size="8">
        {% for b in brands %}
        <option value="{{ b.id }}" {% if selected_brand_ids and b.id in selected_brand_ids %}selected{% endif %}>{{ b.name }} ({{ b.pharma.name }})</option>
        {% endfor %}
      </select>
    </div>
  </div>

  <div class="mt-3">
    <button class="btn btn-primary">Save</button>
    <a class="btn btn-outline-secondary" href="{{ url_for('target_lists.list_target_lists') }}">Cancel</a>
  </div>
</form>
{% endblock %}
